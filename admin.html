<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kenuma Pharma Admin</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #ffebee; }
    h1 { color: #c62828; text-align: center; }
    form { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
    input, select, button { padding: 10px; margin: 5px 0; width: 100%; box-sizing: border-box; }
    button { background: #c62828; color: white; border: none; cursor: pointer; }
    table, th, td { border: 1px solid #ccc; border-collapse: collapse; margin-top: 20px; width: 100%; }
    th, td { padding: 10px; text-align: left; }
    .delete { background: #d32f2f; }
    .container { max-width: 800px; margin: 0 auto; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üì¶ Kenuma Pharma Admin Panel</h1>

    <!-- Add Product Form -->
    <form id="productForm">
      <h3>Add New Product</h3>
      <input type="text" id="name" placeholder="Product Name" required />
      <input type="number" id="price" placeholder="Price (Br)" step="0.01" required />
      <input type="text" id="category" placeholder="Category (e.g., Medicines)" required />
      <input type="text" id="imageUrl" placeholder="Image URL (e.g., insulinsyringe.jpg)" required />
      <button type="submit">‚ûï Add Product</button>
    </form>

    <!-- Product List -->
    <div id="productList">
      <h3>Products</h3>
      <table id="productsTable">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Price (Br)</th>
            <th>Category</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>
  </div>

  <script>
    const API_URL = 'https://kenuma-backend.onrender.com/api';

    // Load products on page load
    window.onload = () => {
      fetchProducts();
    };

    // Fetch and display products
    async function fetchProducts() {
      try {
        const res = await fetch(`${API_URL}/products`);
        const products = await res.json();
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '';
        products.forEach(p => {
          const row = `<tr>
            <td>${p.id}</td>
            <td>${p.name}</td>
            <td>Br ${p.price.toFixed(2)}</td>
            <td>${p.category}</td>
            <td>
              <button class="delete" onclick="deleteProduct(${p.id})">üóëÔ∏è Delete</button>
            </td>
          </tr>`;
          tbody.innerHTML += row;
        });
      } catch (err) {
        alert('Failed to load products: ' + err.message);
      }
    }

    // Add product
    document.getElementById('productForm').onsubmit = async (e) => {
      e.preventDefault();
      const product = {
        name: document.getElementById('name').value.trim(),
        price: parseFloat(document.getElementById('price').value),
        category: document.getElementById('category').value.trim(),
        imageUrl: document.getElementById('imageUrl').value.trim()
      };

      // Auto-convert image path to full URL if needed
      if (!product.imageUrl.startsWith('http')) {
        product.imageUrl = `https://kenuma-backend.onrender.com/images/${product.imageUrl}`;
      }

      try {
        const res = await fetch(`${API_URL}/products`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(product)
        });
        if (res.ok) {
          alert('‚úÖ Product added successfully!');
          document.getElementById('productForm').reset();
          fetchProducts();
        } else {
          alert('‚ùå Failed to add product');
        }
      } catch (err) {
        alert('‚ùå Error: ' + err.message);
      }
    };

    // Delete product
    async function deleteProduct(id) {
      if (!confirm('Are you sure you want to delete this product?')) return;
      try {
        const res = await fetch(`${API_URL}/products/${id}`, { method: 'DELETE' });
        if (res.ok) {
          alert('‚úÖ Product deleted');
          fetchProducts();
        } else {
          alert('‚ùå Failed to delete product');
        }
      } catch (err) {
        alert('‚ùå Error: ' + err.message);
      }
    }
  </script>
</body>
</html>